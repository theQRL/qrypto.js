#!/usr/bin/env node
/**
 * Verify a Dilithium5 signature generated by pq-crystals reference using qrypto.js.
 * Reads: /tmp/ref_dilithium5_pk.bin, /tmp/ref_dilithium5_sig.bin, /tmp/ref_dilithium5_msg.bin
 */

import { readFileSync } from 'fs';
import { cryptoSignVerify } from '../../packages/dilithium5/src/sign.js';

console.log('=== qrypto.js Dilithium5 Verification (pq-crystals signature) ===');

// Read pq-crystals generated files
const pk = readFileSync('/tmp/ref_dilithium5_pk.bin');
const sig = readFileSync('/tmp/ref_dilithium5_sig.bin');
const msg = readFileSync('/tmp/ref_dilithium5_msg.bin');

console.log(`Public key size: ${pk.length} bytes`);
console.log(`Signature size: ${sig.length} bytes`);
console.log(`Message size: ${msg.length} bytes`);
console.log(`Message: "${msg.toString('utf8')}"`);
console.log(`Public key (first 32 bytes): ${pk.slice(0, 32).toString('hex')}`);
console.log(`Signature (first 32 bytes): ${sig.slice(0, 32).toString('hex')}`);

// Verify signature
const valid = cryptoSignVerify(sig, msg, pk);

if (valid) {
  console.log('\n✓ Signature verification PASSED');
  process.exit(0);
} else {
  console.error('\n✗ Signature verification FAILED');
  process.exit(1);
}
